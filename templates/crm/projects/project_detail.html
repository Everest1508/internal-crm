{% extends 'layouts/base.html' %}

{% block title %} {{ project.title }} {% endblock title %}

{% block content %}

  <div class="container-fluid py-4">
    <div class="row">
      <div class="col-12">
        <div class="card mb-4">
          <div class="card-header pb-0">
            <div class="row">
              <div class="col-6 d-flex align-items-center">
                <h6>Project Details</h6>
              </div>
              <div class="col-6 text-end">
                <a href="/crm/projects/" class="btn btn-secondary btn-sm">
                  <i class="fas fa-arrow-left"></i> Back to Projects
                </a>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-8">
                <h5>{{ project.title }}</h5>
                {% if project.description %}
                <p class="text-muted">{{ project.description }}</p>
                {% endif %}
                
                <div class="row mt-4">
                  <div class="col-md-6">
                    <h6>Project Information</h6>
                    <p><strong>Client:</strong> 
                      <a href="/crm/clients/{{ project.client.id }}/">{{ project.client.name }}</a>
                    </p>
                    <p><strong>Status:</strong> 
                      <span class="badge badge-sm bg-gradient-{{ project.status|yesno:'success,warning' }}">
                        {{ project.get_status_display }}
                      </span>
                    </p>
                    <p><strong>Priority:</strong> 
                      <span class="badge badge-sm bg-gradient-{{ project.priority|yesno:'success,warning' }}">
                        {{ project.get_priority_display }}
                      </span>
                    </p>
                  </div>
                  
                  <div class="col-md-6">
                    <h6>Timeline & Financial</h6>
                    {% if project.start_date %}
                    <p><strong>Start Date:</strong> {{ project.start_date|date:"M d, Y" }}</p>
                    {% endif %}
                    {% if project.due_date %}
                    <p><strong>Due Date:</strong> {{ project.due_date|date:"M d, Y" }}</p>
                    {% endif %}
                    {% if project.budget %}
                    <p><strong>Budget:</strong> ₹{{ project.budget|floatformat:2 }}</p>
                    {% endif %}
                    <p><strong>Assigned To:</strong> {{ project.assigned_to.get_full_name|default:project.assigned_to.username }}</p>
                    <p><strong>Created:</strong> {{ project.created_at|date:"M d, Y" }}</p>
                  </div>
                </div>
                
                {% if requirements %}
                <div class="mt-4">
                  <h6>Requirements ({{ requirements.count }})</h6>
                  <div class="list-group">
                    {% for requirement in requirements %}
                    <div class="list-group-item">
                      <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">{{ requirement.title }}</h6>
                        <small class="text-muted">
                          {% if requirement.is_completed %}
                            <span class="badge badge-sm bg-success">Completed</span>
                          {% else %}
                            <span class="badge badge-sm bg-warning">Pending</span>
                          {% endif %}
                        </small>
                      </div>
                      <p class="mb-1">{{ requirement.description }}</p>
                      <small class="text-muted">Created: {{ requirement.created_at|date:"M d, Y" }}</small>
                    </div>
                    {% endfor %}
                  </div>
                </div>
                {% endif %}
                
                <!-- Payment Installments Section -->
                <div class="mt-4">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6>Payment Installments</h6>
                    <a href="/crm/payments/create/?project={{ project.id }}" class="btn btn-warning btn-sm">
                      <i class="fas fa-plus"></i> Add Payment
                    </a>
                  </div>
                  
                  {% if project.payment_installments.all %}
                    <div class="table-responsive">
                      <table class="table table-sm">
                        <thead>
                          <tr>
                            <th>Title</th>
                            <th>Amount</th>
                            <th>Due Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for installment in project.payment_installments.all %}
                          <tr>
                            <td>{{ installment.title }}</td>
                            <td>₹{{ installment.amount }}</td>
                            <td>{{ installment.due_date|date:"M d, Y" }}</td>
                            <td>
                              {% if installment.status == 'paid' %}
                                <span class="badge badge-sm bg-success">Paid</span>
                              {% elif installment.status == 'overdue' %}
                                <span class="badge badge-sm bg-danger">Overdue</span>
                              {% else %}
                                <span class="badge badge-sm bg-warning">Pending</span>
                              {% endif %}
                            </td>
                            <td>
                              <a href="/crm/payments/{{ installment.id }}/edit/" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-edit"></i>
                              </a>
                            </td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  {% else %}
                    <div class="text-center py-3">
                      <p class="text-muted mb-2">No payment installments yet</p>
                      <a href="/crm/payments/create/?project={{ project.id }}" class="btn btn-warning btn-sm">
                        <i class="fas fa-plus"></i> Create First Payment
                      </a>
                    </div>
                  {% endif %}
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h6>Quick Actions</h6>
                  </div>
                  <div class="card-body">
                    <a href="/crm/projects/{{ project.id }}/edit/" class="btn btn-primary btn-sm w-100 mb-2">
                      <i class="fas fa-edit"></i> Edit Project
                    </a>
                    <a href="/crm/projects/{{ project.id }}/requirements/add/" class="btn btn-info btn-sm w-100 mb-2">
                      <i class="fas fa-plus"></i> Add Requirement
                    </a>
                    <a href="/crm/payments/create/?project={{ project.id }}" class="btn btn-warning btn-sm w-100 mb-2">
                      <i class="fas fa-credit-card"></i> Add Payment
                    </a>
                    <a href="/crm/projects/{{ project.id }}/complete/" class="btn btn-success btn-sm w-100">
                      <i class="fas fa-check"></i> Mark Complete
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

{% endblock content %}

